<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
    <link rel="stylesheet" href="/css/app.css">
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <title>Identity Example Site</title>
</head>

<body>
    <div id="root"></div>
    <div class="App">
        
                <li onClick={this.openIdentityWidget}>
                    <a>Login</a>
                </li>
            </ul>


            <h1 class='bannerText1'> Netlify
                <strong onClick={this.handleLogIn} class="bannerText1strong">LOGIN SCREEN</strong>
            </h1>

        </div>
        
        <div class="container shiftUp">
            <div class="row">
                <div class="col s12">
                <div class="card-panel grey lighten-5 black-text ">
                    <main>
                        <p id="primary-text">
                        You are not logged in yet. You have to log in to get to the dashboard dude. What is wrong with you?!? 
                        </p>
                        
                        <button class="btn waves-effect waves-light black" type="submit" name="action" data-netlify-identity-button><i class="material-icons right"></i></button>
                    </main>
                </div>
                </div>
            </div>
           
    </div>
    <script>
    // This function does the date comparison and logs the user out if necessary, also updates the text.
            const updateLoginText = ()=>{
                document.getElementById("primary-text").textContent="Looks like you've logged in successfully! Now try clicking the 'Test Auth' link at the top!"
            }
            const compareDate = (exp) => {
                const d = Date.now()
                if (d > exp){
                console.log("Your identity session has expired")
                netlifyIdentity.logout();
                netlifyIdentity.open();
                } else {
                console.log("the token hasn't expired, yet")
                updateLoginText()
                }
            }
            if (window.netlifyIdentity) {
    // Check if the JWT token is expired, if so log out the user          
                netlifyIdentity.on("login", user => {
                console.log(user)
                compareDate(user.token.expires_at)
                });
    // Redirect to the main page after a successful login
                window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        updateLoginText()
                    });
                }
            });   
            }
            
    </script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".button-collapse").sideNav();
        })
    </script>

</body>

</html>
